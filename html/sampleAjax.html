<!DOCTYPE html>
<html>
<body onload="loadDoc()">

<h2>The XMLHttpRequest Object</h2>

<p id="demo">Let AJAX change this text.</p>
<p id="director"></p>
<!-- <button type="button" onclick="loadDoc()">Change Content</button> -->

<script>
var arrayOfElements = [];
var arrayToDisplay = [];
var arrayOfNotLatestImages = [];
var jsonData;
var increment = 0;
function loadDoc() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
       jsonData = this.responseText;
      processData(jsonData);
    }
  };
  xhttp.open("GET", "https://qa.appranix.net/web/onprem/services/list", true);
  xhttp.setRequestHeader('content-type','application/json');
  xhttp.setRequestHeader('Authorization','Basic WU1VQWdQajZrUkFSaHdrV3RzRng=');
  xhttp.setRequestHeader('accept','application/json')
  xhttp.send();
}
function processData(jsonData) {
console.log("before parse");
var parseJsonData = JSON.parse(jsonData);
for (var key in parseJsonData) {
  console.log(" key value  " + key);
  var keyValue = key;
var valueOfJson = parseJsonData[key];

	for ( var i in valueOfJson) {
    var obj = {};
    obj['key'] = key;
    obj['value'] = valueOfJson[i];
    arrayOfElements.push(obj);

        for (var individualImage in valueOfJson[i]) {
          var objWithLatestKey = {};
          if(individualImage === 'latest') {
          objWithLatestKey['key'] = key;
          var imageName = valueOfJson[i][individualImage].split(":");
          objWithLatestKey['value'] = imageName[0];
          objWithLatestKey['version'] = imageName[1];
          arrayToDisplay.push(objWithLatestKey);
        console.log(individualImage);
        console.log(valueOfJson[i][individualImage]);
      }
        objWithLatestKey['key'] = key;
        var imageName = valueOfJson[i][individualImage].split(":");
        objWithLatestKey['value'] = imageName[0];
        objWithLatestKey['version'] = imageName[1];
        arrayOfNotLatestImages.push(objWithLatestKey);

        }
	}
  viewAll();
}
}
function viewAll() {
  console.log("in viewall");
  var text = "<table border ='0'><tr><th>Id</th><th>Name</th><th>ImageName</th><th>version</th></tr>"
  for (var i=0;i<arrayToDisplay.length;i++){
  var value = arrayToDisplay[i];
  console.log("value " + value.key);
  text+="<tr><td>"+(i+1)+"</td><td>"+value.key+"</td><td><a id="+value.key+" href='#' onclick='javascript:viewNonLatestImages(this); return false;' >"+value.value+"</a></td><td>"+value.version+"</td></tr>";
}
text+="</table>";
document.getElementById("demo").innerHTML = text;
}
function viewNonLatestImages(imageDetails) {
  var imageName = document.getElementById(imageDetails.id).id;
  console.log("in viewNonLatestImages " + imageName);
  var text = "<table border ='0'><tr><th>Id</th><th>Name</th><th>ImageName</th><th>version</th></tr>"
  var localIncrement = 1;
  for (var i=0;i<arrayOfNotLatestImages.length;i++){
  var value = arrayOfNotLatestImages[i];
  console.log("value " + value.key);
  if(value.key === imageName) {
  text+="<tr><td>"+localIncrement+"</td><td>"+value.key+"</td><td>";
  text+=value.value+"</a></td><td>"+value.version+"</td></tr>";
  localIncrement = localIncrement + 1;
}
}
text+="</table>";
document.getElementById("demo").innerHTML = text;
}
</script>

</body>
</html>
